# 2장 느려진 서비스, 어디부터 봐야 할까
## 처리량과 응답 시간
- 서버 성능 지표
    - 네트워크 속도
    - 디스크 속도
    - 메모리 크기
    - 디바이스(스마트 폰)의 CPU 속도 등

<br>

### 응답 시간
- 성능 측정 도구에서 response time으로 표시

<br>

- 응답 시간 측정 기준
    - TTFB(Time to First Byte) : 응답 시간 중 첫 번째 바이트가 도착할 때까지 걸린 시간
    - TTLB(Time to Last Byte) : 응답 시간 중 마지막 바이트가 도착할 때까지 걸린 시간

<br>

```
"응답 시간이 증가하면 트래픽과 매출이 줄어든다."

응답 시간이 증가하면 트래픽이 줄어드는 이유는 사용자 경험(UX)과 검색 엔진 최적화(SEO) 측면에서 부정적인 영향을 주기 때문입니다. 구체적인 이유는 다음과 같습니다:

✅ 1. 사용자 이탈 증가
✅ 2. 재방문율 감소
✅ 3. 검색 엔진 순위 하락 (SEO)
✅ 4. 공유 감소
✅ 5. 브라우저 또는 앱의 연결 제한
```

<br>

- 서버 처리 시간 요소
    - 로직 수행(if, for 등)
    - DB 연동(SQL 실행)
    - 외부 API 연동
    - 응답 데이터 생성(전송)

→ DB 연동과 외부 API 연동이 큰 비중 차지

<br>

### 처리량
- 성능 측정 도구에서 throughput으로 표현

<br>

- TPS
    - 초당 트랜잭션 수
    - trascation per second
- 최대 TPS
    - 시스템이 처리할 수 있는 최대 요청 수
    - 동시에 들어오는 요청 수가 최대 TPS를 초과하면 서버는 초과한 요청을 나중에 처리 (응답 시간 지연)
- RPS
    - 초당 요쳥 수
    - request per second

<br>

- 응답 시간 증가 방지 방법(TPS를 높이는 방법)
    - 서버가 동시에 처리할 수 있는 요청 수를 늘려서 대기 시간 줄이기
    - 처리 시간 자체를 줄여 대기 시간 줄이기
- 성능 개선 방법
    1. 트래픽이 많은 시간대의 현재 서버의 TPS와 응답 시간 측정
        - TPS 확인 방법 : 모니터링 시스템 활용
    2. 목표 TPS와 응답 시간 설정
    3. 효과적인 성능 개선안 도출

<br>

## 서버 성능 개선 기초
### 병목 지점
- TPS를 높이는 방법
    1. 성능 문제가 발생하는 지점 찾기 (성능 문제는 응답 시간이 길어지면서 발생하는 경우가 많음)
    2. 실제 실행 시간 추측 (모니터링 도구, 실행 시간을 로그로 남겨두기)

→ 성능 문제는 주로 DB나 외부 API를 연동하는 과정에서 발생

<br>

↓ `서버 관점에서 처리량과 응답 시간을 개선하는 방법`

<br>

### 수직 확장과 수평 확장
- 급한 불을 끄고 나서 -> 근본적인 해결책 모색
    - 급한 불을 끄는 방법 : 수직 확장(scale-up)
- 수직 확장(scale-up) : CPU, 메모리, 디스크 등의 자원 증가
- 수평 확장(scale-out) : 서버 늘리기 (TPS 높이기)
    - 서버가 두 대 이상이면 로드 밸런서 필요
- 로드 밸런서 : 사용자 트래픽을 각 서버에 골고루 분배해서 한 서버에 사용자 트래픽이 몰리지 않도록 함 → 전체 서버 자원을 효율적으로 사용
    - 로드 밸런서가 트래픽을 알맞게 분산시키기 위해 사용하는 방법
        - 정적인 방식
            - 라운드 로빈 : 클라이언트의 요청을 각 서버에 순차적으로 분배
            - IP 해시 : 클라이언트의 IP 주소를 해시한 값을 기반으로 요청을 전달할 서버 결정 (IP 해시값은 동일하기 때문에 동일한 클라이언트는 항상 같은 서버로 연결되도록 해줌)
        - 동적인 방식 : 서버의 현재 상태에 따라 트래픽을 분산하는 방식으로 트래픽이 적은 서버에 요청을 보내는 형태로 동작 (연결 수가 더 적은 서버에 요청을 보내거나, 응답 시간이 더 짧은 서버에 요청을 보냄)
```
✅ 라운드 로빈 / 동적인 방식 차이 요약

항목                 라운드 로빈 (Round Robin)   동적인 방식
📌 분배 기준        순서 (정적인 규칙)          서버 상태 (실시간 동적 정보)
📈 서버 부하 반영   ❌ 안 함 (단순 분배)        ✅ 함 (실시간 부하 감지)
⚖️ 장점             구현이 단순하고 예측 가능   서버 자원을 효율적으로 활용
⚠️ 단점             부하가 불균형해질 수 있음   구현이 복잡하고 비용 발생 가능
💡 예시              서버 A → B → C → A → ...    응답 빠른 서버, 연결 적은 서버 선택
```
