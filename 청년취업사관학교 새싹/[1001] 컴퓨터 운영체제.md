# 컴퓨터 운영체제

<br>

## Chapter 09 운영체제 시작하기

<br>

- 운영체제
    - 실행할 프로그램에 필요한 자원을 할당하고, 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램
    - 커널 영역에 적재되는 프로그램

<br>

```java
┌[메모리]───────────┐
│   // 커널 영역    │
│   [운영체제]      │
│───────────────────│
│   // 사용자 영역  │
│   [응용 프로그램] │
│   [응용 프로그램] │
│   [응용 프로그램] │
└───────────────────┘
```

<br>

- 커널
    - 운영체제의 핵심 기능을 담당

<br>

- 이중 모드
    - CPU가 명령어를 실행하는 모드를 커널 모드와 사용자 모드로 구분하는 방식

<br>

- 시스템 호출
    - 운영체제의 서비스를 제공받기 위해 커널 모드로 전환하는 방법

<br>

- 운영체제의 핵심 서비스
    - 프로세스 관리
    - 자원 접근 및 할당
        - CPU : CPU 스케줄링
        - 메모리 : 가상 메모리
        - 입출력장치 : 인터럽트 서비스 루틴
    - 파일 시스템 관리
    
<br><br>

## Chapter 10 프로세스와 스레드

<br>

- 스레드
    - 프로세스 내의 실행 흐름 단위
    - 각기 다른 스레드 ID, 프로그램 카운터 값을 비롯한 레지스터 값, 스택으로 구성
        - 스레드마다 각기 다른 코드를 실행할 수 있음
    - 실행에 필요한 최소한의 정보만을 유지한 채 프로세스 자원을 공유하며 실행
        - 실행에 필요한 최소한의 정보 : 프로그램 카운터, 레지스터, 스택
        - 프로세스 자원 : 힙, 데이터, 코드 영역

<br>

- 멀티프로세스
    - 여러 프로세스를 동시에 실행하는 것
    - 같은 프로세스 내의 자원을 공유

<br>

- 멀티스레드
    - 여러 스레드로 프로세스를 동시에 실행하는 것
    - 프로세스끼리는 자원을 공유하지 않음

<br><br>

## Chapter 12 프로세스 동기화

<br>

- 동기화
    - 특정 자원에 접근할 때 한 개의 프로세스만 접근하게 하거나 프로세스를 올바른 순서대로 실행하게 하는 것

<br>

- <b>상호 배제를 위한 동기화</b>
    - 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기
    - <b>원칙</b>
        - <b>상호 배제</b>
            - 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없음
        - <b>진행</b>
            - 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 함
        - <b>유한 대기</b>
            - 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 함
            - 임계 구역에 들어오기 위해 무한정 대기해서는 안 됨

<br>

- 실행 순서 제어를 위한 동기화
    - 프로세스를 올바른 순서대로 실행하기

<br>

- 공유 자원
    - 공동으로 사용하는 자원 : 전역 변수, 파일, 입출력장치, 보조기억장치

<br>

- 임계 구역
    - 공유 자원에 접근하는 코드 중 동시에 실행하면 문제가 발생하는 코드 영역
    - 임계 구역에 진입한 프로세스가 있다면 다른 프로세스는 임계 구역 밖에서 기다려야 함

<br><br>

## Chapter 13 교착 상태

<br>

- 교착 상태
    - 일어나지 않을 사건을 기다리며 무한히 대기하는 현상
    - 발생 조건 : 상호 배제, 점유와 대기, 비선점, 원형 대기

<br>

- 자원 할당 그래프를 이용해 교착 상태를 표현할 수 있음

<br><br>

## Chapter 14 가상 메모리

<br>

- 가상 메모리
    - 실행하고자 하는 프로그램을 일부만 메모리에 적재하여 실제 물리 메모리 크기보다 더 큰 프로세스를 실행할 수 있게 하는 기술
    - 관리 기법 : 페이징, 세그멘테이션

<br>

- 페이징
    - 물리 주소 공간을 프레임 단위로 자르고
    - 프로세스의 논리 주소 공간을 페이지 단위로 자른 뒤
    - 각 페이지를 프레임에 할당하는 가상 메모리 관리 기법

<br>

- 페이지 테이블
    - 페이지가 적재된 프레임을 찾을 수 있음
    - 현재 어떤 페이지가 어떤 프레임에 할당되었는지를 알려 줌
    - 프로세스마다 각자의 페이지 테이블을 가지고 있음
        - 메모리에 적재되어 있음
            - 페이지 테이블을 메모리에 두면 메모리 접근 시간이 두 배로 늘어남 -> `TLB`
    - 페이지 번호와 프레임 번호뿐 아니라 유효 비트, 보호 비트, 접근 비트, 수정 비트 등이 있음 -> `페이지 테이블 엔트리`

<br>

- PTBR (페이지 테이블 베이스 레지스터)
    - 각 프로세스의 페이지 테이블이 적재된 주소를 가리킴

<br>

```java
┌[CPU]──────────────────────────────────┐
│   ┌[PTBR]─────────────────────────┐   │   ┌[메모리]───────────────────────┐
│   │   [프로세스 A 페이지 테이블]  │───│──→│   [프로세스 A 페이지 테이블]  │
│   └───────────────────────────────┘   │   └───────────────────────────────┘
└───────────────────────────────────────┘

// 프로세스 A 실행 시
// PTBR은 프로세스 A의 페이지 테이블을 가리키고,
// CPU는 프로세스 A의 페이지 테이블을 통해 프로세스 A의 페이지가 적재된 프레임을 알 수 있음
``` 

<br>

- TLB (Translation Lookaside Buffer)
    - 페이지 테이블의 캐시 메모리 역할을 수행하기 위해 페이지 테이블의 일부를 저장
    - 참조 지역성에 근거해 주로 최근에 사용된 페이지 위주로 가져와 저장

<br>

```java
[CPU]
    | [페이지 번호|변위]
┌[페이지 테이블]────────┐
│페이지 번호|프레임 번호│
│...                    │
└───────────────────────┘
    | [프레임 번호|변위]
┌[메모리]┐
│프레임  │
│...     │
└────────┘
```

<br>

- <b>페이지 테이블 엔트리</b>
    - 페이지 테이블의 각각의 행들
    - <b>유효 비트</b>
        - 현재 해당 페이지에 접근이 가능한지 여부
            - 1 : 페이지가 메모리가 적재되어 있음
            - 0 : 페이지가 메모리에 적재되어 있지 않음
                - 페이지 폴트라는 예외가 발생
                    - 페이지 폴트를 처리하는 과정은 하드웨어 인터럽트를 처리하는 과정과 유사
    - <b>보호 비트</b>
        - 페이지 보호 기능을 위해 존재하는 비트
            - <b>r</b> (Read, 읽기)
                - 1 : 읽기 가능
                - 0 : 읽기 불가능
            - <b>w</b> (Write, 쓰기)
                - 1 : 쓰기 가능
                - 0 : 쓰기 불가능
            - <b>x</b> (eXecute, 실행)
                - 1 : 실행 가능
                - 0 : 실행 불가능
    - <b>참조 비트</b>
        - CPU가 이 페이지에 접근한 적이 있는지 여부
            - 1 : 적재 이후 CPU가 읽거나 쓴 페이지
            - 0 : 적재 이후 한 번도 읽거나 쓴 적이 없는 페이지
    - <b>수정 비트</b> = 더티 비트
        - 해당 페이지에 데이터를 쓴 적이 있는지 없는지 수정 여부
            - 1 : 변경된 적이 있는 페이지
            - 0 : 변경된 적이 없는 페이지 = 한 번도 접근한 적 없거나 읽기만 했던 페이지
        - 페이지가 메모리에 사라질 때 보조기억장치에 쓰기 작업을 해야 하는지, 할 필요가 없는지 판단하기 위해 존재
